# This is a basic workflow to help you get started with Actions

name: Release

# Controls when the workflow will run
on:
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
  
  # Allow reuse of this workflow
  workflow_call:
  
# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # job name
  release:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      
      - name: Download artifact
        uses: dawidd6/action-download-artifact@v2
        with:
          #github_token: ${{secrets.GITHUB_TOKEN}}
          # Required, workflow file name or ID
          workflow: compile.yml
          branch: main
          # artifact name downloaded
          name: build-result
          # Optional, choose to skip unpacking the downloaded artifact(s)
          # default false
          #skip_unpack: true
          
      - name: List files for the log
        run: ls -al
      
      - name: version
        run: echo "::set-output name=version::$(date +%Y-%m-%d.%s)"
        id: version
        
      - name: Rename release
        run: "mv build-result.tar.gz build-${{ steps.version.outputs.version }}.tar.gz"
      
      # create a release
      - uses: "ncipollo/release-action@v1"
        with:
          tag: "${{ steps.version.outputs.version }}"
          #token: "${{ secrets.GITHUB_TOKEN }}"
          name: "${{ steps.version.outputs.version }}"
          prerelease: false
          draft: false
          #generateReleaseNotes: false
          bodyFile: .github/AUTORELEASE.md
          allowUpdates: true
          artifacts: "build-${{ steps.version.outputs.version }}.tar.gz"
          artifactContentType: application/gzip
  
